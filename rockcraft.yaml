name: ratings
version: 0.0.4
license: GPL-3.0

base: bare
build-base: ubuntu@22.04
platforms:
  amd64:

summary: App Center Ratings Service
description: App ratings service Ubuntu App Center.

#run-user: _daemon_

environment:
  APP_ENV: dev
  APP_HOST: 0.0.0.0
  APP_JWT_SECRET: unset
  APP_LOG_LEVEL: info
  APP_NAME: ratings
  APP_PORT: "8080"
  APP_POSTGRES_URI: unset
  APP_MIGRATION_POSTGRES_URI: unset

services:
  ratings:
    override: replace
    startup: enabled
    command: "/bin/ratings"

parts:
  rust-dependencies:
    plugin: nil
    override-pull: |
      curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y

  ratings:
    after: [ rust-dependencies ]
    plugin: rust
    build-packages:
      - libssl-dev
      - pkg-config
      - protobuf-compiler
      - libprotobuf-dev
    source: .
    stage-packages:
      - libc6_libs
      - libgcc-s1_libs
      - ca-certificates_data

  migrations:
    plugin: dump
    source: ./sql/
    organize:
        migrations : sql/migrations
